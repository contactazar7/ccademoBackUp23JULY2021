<apex:page controller="LookupPopupController" sidebar="false" showheader="false" lightningStylesheets="true">
  <apex:includescript value="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"/>
  <script type="text/javascript">
    window.onload = new function() { 
      //bring popup window to front
      window.focus(); 
      var ele = document.getElementById('{!$Component.form.block.section.query}');
      if(ele)
        ele.focus();
    }
   
    function fillIn(name, id) {
      var winMain = window.parent.opener;
      winMain.setValues(name, id);
      CloseWindow();
    }

    function CloseWindow() {
      var winMain = window.opener;
      if(null == winMain)
        winMain = window.parent.opener;
      winMain.closeLookupPopup();
    }
  </script>

  <apex:pageMessages />
  <apex:form id="form">  
    <div style="width 100%">
      <apex:pageBlock title="Lookup" id="block">
        <apex:pageBlockSection id="section">
          Enter search text and click Go<br/>
          <apex:inputText value="{!query}" id="query"/> 
          <apex:commandButton value="Go" action="{!runQuery}"/>
        </apex:pageBlockSection>
      </apex:pageBlock>

      <apex:pageBlock >
        <apex:pageBlockSection columns="1">
          <apex:pageBlockTable value="{!records}" var="record">
            <apex:column headerValue="{!$ObjectType[objectName].fields.Name.Label}">
              <apex:outputLink value="#" onclick="fillIn('{!record['Name']}', '{!record['id']}')">{!record['Name']}</apex:outputLink>       
            </apex:column>
            <apex:repeat value="{!fields}" var="field">
              <apex:column headerValue="{!$ObjectType[objectName].fields[field].Label}">
                <apex:outputText value="{!record[field]}"/>
              </apex:column>               
            </apex:repeat>
          </apex:pageBlockTable>    
        </apex:pageBlockSection>
      </apex:pageBlock>
      <button type="button" onclick="CloseWindow();">Close Window</button>
     </div>
   </apex:form>
</apex:page>